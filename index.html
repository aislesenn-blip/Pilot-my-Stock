<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilot my Stock | Enterprise Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F5F5F7; }
        .glass { background: rgba(255, 255, 255, 0.95); border: 1px solid rgba(0,0,0,0.05); box-shadow: 0 20px 40px rgba(0,0,0,0.08); }
        .input-field { background: #FFFFFF; border: 1px solid #E5E5E5; transition: all 0.2s; }
        .input-field:focus { border-color: #000; outline: none; ring: 1px solid #000; }
        .btn-black { background: #111; color: #fff; transition: all 0.2s; }
        .btn-black:hover { background: #000; transform: translateY(-1px); }
        .hidden { display: none; }
    </style>
</head>
<body class="flex items-center justify-center h-screen px-4">

    <div class="glass w-full max-w-[420px] p-10 rounded-3xl animate-fade-in">
        <div class="mb-8">
            <h1 class="text-2xl font-bold tracking-tight text-gray-900">Pilot my Stock.</h1>
            <p class="text-xs text-gray-500 mt-2 font-medium tracking-wide">ENTERPRISE OPERATING SYSTEM</p>
        </div>

        <div class="flex p-1 bg-gray-100 rounded-xl mb-8">
            <button onclick="switchTab('login')" id="tab-login" class="flex-1 py-2.5 text-sm font-semibold rounded-lg bg-white shadow-sm transition">Sign In</button>
            <button onclick="switchTab('register')" id="tab-register" class="flex-1 py-2.5 text-sm font-medium text-gray-500 hover:text-gray-900 transition">Create Account</button>
        </div>

        <form id="loginForm" class="space-y-5">
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Work Email</label>
                <input type="email" id="loginEmail" class="input-field w-full p-3.5 rounded-xl mt-1.5 text-sm font-medium" placeholder="name@company.com" required>
            </div>
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Password</label>
                <input type="password" id="loginPass" class="input-field w-full p-3.5 rounded-xl mt-1.5 text-sm font-medium" placeholder="••••••••" required>
            </div>
            <button type="submit" class="btn-black w-full py-4 rounded-xl font-bold text-sm mt-2">Access Portal</button>
        </form>

        <form id="registerForm" class="space-y-5 hidden">
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Full Legal Name</label>
                <input type="text" id="regName" class="input-field w-full p-3.5 rounded-xl mt-1.5 text-sm font-medium" placeholder="e.g. John Doe" required>
            </div>
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Work Email</label>
                <input type="email" id="regEmail" class="input-field w-full p-3.5 rounded-xl mt-1.5 text-sm font-medium" placeholder="name@company.com" required>
            </div>
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Set Password</label>
                <input type="password" id="regPass" class="input-field w-full p-3.5 rounded-xl mt-1.5 text-sm font-medium" placeholder="••••••••" required>
            </div>
            <button type="submit" class="btn-black w-full py-4 rounded-xl font-bold text-sm mt-2">Create Account</button>
        </form>

        <p id="msg" class="text-center text-xs text-red-600 mt-6 font-medium min-h-[20px]"></p>
    </div>

    <script type="module">
        import { login, register, getCurrentProfile } from './js/auth.js';

        window.switchTab = (tab) => {
            document.getElementById('msg').innerText = '';
            if(tab === 'login') {
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('tab-login').classList.add('bg-white', 'shadow-sm', 'font-semibold');
                document.getElementById('tab-login').classList.remove('text-gray-500', 'font-medium');
                document.getElementById('tab-register').classList.remove('bg-white', 'shadow-sm', 'font-semibold');
                document.getElementById('tab-register').classList.add('text-gray-500', 'font-medium');
            } else {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
                document.getElementById('tab-register').classList.add('bg-white', 'shadow-sm', 'font-semibold');
                document.getElementById('tab-register').classList.remove('text-gray-500', 'font-medium');
                document.getElementById('tab-login').classList.remove('bg-white', 'shadow-sm', 'font-semibold');
                document.getElementById('tab-login').classList.add('text-gray-500', 'font-medium');
            }
        };

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            btn.innerText = 'Verifying...'; btn.disabled = true;
            try {
                const data = await login(email, pass);
                const profile = await getCurrentProfile(data.user.id);
                window.location.href = (!profile || !profile.organization_id) ? 'setup.html' : 'dashboard.html';
            } catch (err) {
                document.getElementById('msg').innerText = "Authentication failed.";
                btn.innerText = 'Access Portal'; btn.disabled = false;
            }
        });

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;

            if(!name) { document.getElementById('msg').innerText = "Full Name is required"; return; }
            btn.innerText = 'Creating Account...'; btn.disabled = true;

            try {
                await register(email, pass, name);
                const loginData = await login(email, pass); // Auto login
                const profile = await getCurrentProfile(loginData.user.id);
                if (profile && profile.organization_id) {
                    window.location.href = 'dashboard.html';
                } else {
                    window.location.href = 'setup.html';
                }
            } catch (err) {
                document.getElementById('msg').innerText = err.message;
                btn.innerText = 'Create Account'; btn.disabled = false;
            }
        });
    </script>
</body>
</html>
